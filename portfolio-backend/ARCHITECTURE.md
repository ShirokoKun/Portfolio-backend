# ğŸ—ï¸ System Architecture Diagram

## Current Setup (After Implementation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                           â”‚
â”‚                    USER'S BROWSER                         â”‚
â”‚                                                           â”‚
â”‚   https://shirokokun-portfolio.vercel.app                â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
               â”‚                                        â”‚
               â”‚ Static Content                         â”‚ API Calls
               â”‚ (HTML, CSS, JS)                        â”‚ (Fetch Data)
               â”‚                                        â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚                     â”‚                    â”‚
      â”‚  VERCEL CDN     â”‚                     â”‚  BACKEND SERVER    â”‚
      â”‚  (Frontend)     â”‚                     â”‚  (Railway/Render)  â”‚
      â”‚                 â”‚                     â”‚                    â”‚
      â”‚  Next.js App    â”‚                     â”‚  Express.js API    â”‚
      â”‚  â€¢ Portfolio    â”‚                     â”‚  Port: 8080        â”‚
      â”‚  â€¢ Projects     â”‚                     â”‚                    â”‚
      â”‚  â€¢ About        â”‚                     â”‚  Routes:           â”‚
      â”‚  â€¢ Components   â”‚                     â”‚  /api/blog/posts   â”‚
      â”‚                 â”‚                     â”‚  /api/blog/post/:s â”‚
      â”‚  Uses:          â”‚                     â”‚  /api/contact      â”‚
      â”‚  api-client.ts â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  /health           â”‚
      â”‚                 â”‚                     â”‚                    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                                                 â”‚              â”‚
                                                 â”‚              â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚                â”‚   â”‚               â”‚
                                   â”‚  SUBSTACK RSS  â”‚   â”‚ GOOGLE SHEETS â”‚
                                   â”‚                â”‚   â”‚               â”‚
                                   â”‚  Your Blog     â”‚   â”‚ Contact Form  â”‚
                                   â”‚  Posts Feed    â”‚   â”‚ Responses     â”‚
                                   â”‚                â”‚   â”‚               â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. Blog Posts Flow

```
User visits /blog page
        â†“
Frontend calls apiClient.getBlogPosts()
        â†“
Backend receives GET /api/blog/posts
        â†“
Backend checks cache (30 min TTL)
        â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚       â”‚
  Cache   Cache
  Hit     Miss
    â†“       â†“
 Return   Fetch from
 Cached   Substack RSS
 Posts      â†“
    â”‚      Parse & Cache
    â”‚         â†“
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â†“
    Return JSON to Frontend
         â†“
    Frontend displays posts
```

### 2. Contact Form Flow

```
User fills contact form
        â†“
Frontend calls apiClient.submitContact(data)
        â†“
Backend receives POST /api/contact
        â†“
Validate input (Zod schema)
        â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚        â”‚
  Valid    Invalid
    â†“        â†“
  Pass    Return
  Rate    400 Error
  Limit     â”‚
    â†“       â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”   â”‚
â”‚       â”‚   â”‚
Within  Overâ”‚
Limit   Limit
  â†“       â†“ â”‚
Save to Return
Google  429   â”‚
Sheets  Error â”‚
  â†“       â”‚   â”‚
Append    â”‚   â”‚
New Row   â”‚   â”‚
  â†“       â”‚   â”‚
Return    â”‚   â”‚
Success   â”‚   â”‚
  â†“       â”‚   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
        â†“
Frontend shows result message
```

## File Structure

```
portfolio-backend/
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ index.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Main Entry Point
â”‚   â”‚                               â”‚ â€¢ Initialize Express
â”‚   â”‚                               â”‚ â€¢ Setup middlewares
â”‚   â”‚                               â”‚ â€¢ Register routes
â”‚   â”‚                               â”‚ â€¢ Start server
â”‚   â”‚
â”‚   â”œâ”€â”€ middlewares/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Request Processing
â”‚   â”‚   â”œâ”€â”€ cors.middleware.ts     â”‚ â€¢ Allow frontend access
â”‚   â”‚   â”œâ”€â”€ rate-limit.middleware  â”‚ â€¢ Prevent abuse
â”‚   â”‚   â”œâ”€â”€ validation.middleware  â”‚ â€¢ Validate inputs
â”‚   â”‚   â”œâ”€â”€ error.middleware       â”‚ â€¢ Handle errors
â”‚   â”‚   â””â”€â”€ logger.middleware      â”‚ â€¢ Log requests
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” URL Routing
â”‚   â”‚   â”œâ”€â”€ blog.routes.ts         â”‚ â€¢ /api/blog/*
â”‚   â”‚   â””â”€â”€ contact.routes.ts      â”‚ â€¢ /api/contact
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Request Handlers
â”‚   â”‚   â”œâ”€â”€ blog.controller.ts     â”‚ â€¢ Handle blog requests
â”‚   â”‚   â””â”€â”€ contact.controller.ts  â”‚ â€¢ Handle contact requests
â”‚   â”‚
â”‚   â””â”€â”€ services/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Business Logic
â”‚       â”œâ”€â”€ substack.service.ts    â”‚ â€¢ Fetch RSS feed
â”‚       â”‚                          â”‚ â€¢ Parse posts
â”‚       â”‚                          â”‚ â€¢ Cache management
â”‚       â”‚
â”‚       â””â”€â”€ sheets.service.ts      â”‚ â€¢ Google Sheets API
â”‚                                  â”‚ â€¢ Save messages
â”‚                                  â”‚ â€¢ Test connection
â”‚
â”œâ”€â”€ dist/ (generated) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Compiled JavaScript
â”‚                                  â”‚ (Created by npm run build)
â”‚
â”œâ”€â”€ Configuration Files
â”œâ”€â”€ package.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Dependencies & Scripts
â”œâ”€â”€ tsconfig.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” TypeScript Settings
â”œâ”€â”€ .env â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Environment Variables
â”œâ”€â”€ .env.example â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Environment Template
â””â”€â”€ .gitignore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Git Ignore Rules
```

## Request Flow Through Middleware Stack

```
Incoming Request
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚ HELMET  â”‚  Add security headers
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚  CORS   â”‚  Check origin allowed
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RATE LIMIT  â”‚  Check request count
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
   â”‚ BODY JSON â”‚  Parse request body
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   LOGGER    â”‚  Log request details
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    ROUTER     â”‚  Match route
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  VALIDATION     â”‚  Validate inputs (if POST)
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CONTROLLER   â”‚  Handle request
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   SERVICE    â”‚  Business logic
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   RESPONSE   â”‚  Return JSON
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ERROR HANDLER â”‚  Catch any errors
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Response to Client
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FRONTEND STACK                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Next.js 13                           â”‚
â”‚  â€¢ React 18                             â”‚
â”‚  â€¢ TypeScript                           â”‚
â”‚  â€¢ Tailwind CSS                         â”‚
â”‚  â€¢ Vercel Deployment                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ HTTP Requests
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKEND STACK                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Node.js 18+                          â”‚
â”‚  â€¢ Express.js                           â”‚
â”‚  â€¢ TypeScript                           â”‚
â”‚  â€¢ RSS Parser                           â”‚
â”‚  â€¢ Google Sheets API                    â”‚
â”‚  â€¢ Node Cache                           â”‚
â”‚  â€¢ Helmet (Security)                    â”‚
â”‚  â€¢ CORS                                 â”‚
â”‚  â€¢ Zod (Validation)                     â”‚
â”‚  â€¢ Railway/Render Deployment            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSTACK RSS  â”‚    â”‚  GOOGLE SHEETS    â”‚
â”‚                â”‚    â”‚                   â”‚
â”‚  â€¢ Blog Posts  â”‚    â”‚  â€¢ Form Storage   â”‚
â”‚  â€¢ Content     â”‚    â”‚  â€¢ Spreadsheet    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚  ğŸ”’ Security Layer 1: HELMET                â”‚
â”‚     â€¢ XSS Protection                        â”‚
â”‚     â€¢ Content Security Policy               â”‚
â”‚     â€¢ HSTS                                  â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ”’ Security Layer 2: CORS                  â”‚
â”‚     â€¢ Whitelist frontend domains           â”‚
â”‚     â€¢ Block unauthorized origins            â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ”’ Security Layer 3: RATE LIMITING         â”‚
â”‚     â€¢ General: 100 req/15min               â”‚
â”‚     â€¢ Contact: 5 req/hour                  â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ”’ Security Layer 4: INPUT VALIDATION      â”‚
â”‚     â€¢ Zod schemas                           â”‚
â”‚     â€¢ Type checking                         â”‚
â”‚     â€¢ Sanitization                          â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ”’ Security Layer 5: ENVIRONMENT VARS      â”‚
â”‚     â€¢ No secrets in code                    â”‚
â”‚     â€¢ .env for local                        â”‚
â”‚     â€¢ Platform secrets for production       â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CACHING FLOW               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request for Blog Posts
        â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Check    â”‚
    â”‚  Cache    â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚        â”‚
  Found   Not Found
    â”‚        â”‚
    â†“        â†“
â”Œâ”€â”€â”€â”´â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”€â”€â”
â”‚ Age? â”‚  â”‚ Fetch â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜  â”‚ RSS   â”‚
    â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â†“         â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚< 30min â”‚ â”‚ Parse  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ & Save â”‚
    â”‚      â”‚ Cache  â”‚
    â†“      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚
â”‚ Return â”‚ â—„â”€â”€â”€â”˜
â”‚ Cached â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cache Duration: 30 minutes (1800 seconds)
Cache Type: In-memory (node-cache)
```

---

This architecture provides:
- âœ… Separation of concerns
- âœ… Independent scaling
- âœ… Better performance with caching
- âœ… Enhanced security
- âœ… Easy maintenance
- âœ… Clear data flow
